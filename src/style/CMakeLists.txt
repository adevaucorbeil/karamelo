file(GLOB DIRECTORIES RELATIVE ${CMAKE_CURRENT_SOURCE_DIR} *)
foreach(DIRECTORY ${DIRECTORIES})
  if(IS_DIRECTORY ${CMAKE_CURRENT_SOURCE_DIR}/${DIRECTORY})
    string(TOUPPER "${DIRECTORY}_CLASS" STYLE_CLASS)

    set(STYLE_HEADER "")

    file(GLOB HEADERS RELATIVE ${CMAKE_CURRENT_SOURCE_DIR}/${DIRECTORY} ${DIRECTORY}/*.h)
    foreach(HEADER ${HEADERS})
      file(STRINGS ${DIRECTORY}/${HEADER} IS_STYLE LIMIT_COUNT 1 REGEX ${STYLE_CLASS})
      if(IS_STYLE)
        set(STYLE_HEADER "${STYLE_HEADER}#include <${HEADER}>\n")
      endif()
    endforeach()
    
    set(STYLE_HEADER_PATH "${CMAKE_CURRENT_SOURCE_DIR}/${DIRECTORY}/style_${DIRECTORY}.h")
    file(WRITE ${STYLE_HEADER_PATH} ${STYLE_HEADER})
    set_property(DIRECTORY APPEND PROPERTY CMAKE_CONFIGURE_DEPENDS ${STYLE_HEADER_PATH})
  endif()
endforeach()